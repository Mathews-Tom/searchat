<!DOCTYPE html>
<html>
<head>
    <title>Searchat</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Preload fonts for optimal performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/pygments.css">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">

</head>
<body>
    <div class="container">
        <!-- Left Sidebar: Search Tips -->
        <div class="sidebar">
            <h3>üí° Search Tips</h3>

            <div class="tip">
                <div class="tip-title">Search Modes</div>
                <div class="tip-content">
                    <strong>Hybrid</strong> - Best results (keyword + semantic)<br>
                    <strong>Semantic</strong> - Find by meaning/concept<br>
                    <strong>Keyword</strong> - Exact text matching
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Keyboard Shortcuts</div>
                <div class="tip-content">
                    Press <kbd>?</kbd> to see all shortcuts<br>
                    <small style="color: var(--text-muted);">Quick access: <kbd>/</kbd> search, <kbd>r</kbd> resume, <kbd>c</kbd> chat</small>
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Live Indexing</div>
                <div class="tip-content">
                    New conversations are indexed automatically. In-progress sessions re-index 5 minutes after last edit.
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Missing Conversations?</div>
                <div class="tip-content">
                    Click <strong>Add Missing Conversations</strong> to index files not yet in the search index.
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Filter by Project</div>
                <div class="tip-content">
                    Use the Project dropdown to search within specific projects only.
                </div>
            </div>

            <!-- System Overview Link -->
            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-muted);">
                <h3 style="color: var(--accent-primary); margin-bottom: 12px;">üìä System Overview</h3>
                <a href="/docs/infographics.html" target="_blank" class="system-overview-link">
                    View Interactive Infographics ‚Üí
                </a>
                <div class="tip" style="margin-top: 12px;">
                    <div class="tip-content" style="font-size: 12px;">
                        Explore detailed visualizations of Searchat's architecture, features, and performance metrics.
                    </div>
                </div>
            </div>

            <div class="saved-queries-panel">
                <div class="saved-queries-header">
                    <h3>Saved Queries</h3>
                    <button id="saveQueryButton" type="button">Save Current</button>
                </div>
                <div class="saved-queries-status" id="savedQueriesStatus"></div>
                <div class="saved-queries-form" id="savedQueriesForm">
                    <input type="text" id="savedQueryName" placeholder="Query name" />
                    <input type="text" id="savedQueryDescription" placeholder="Description (optional)" />
                    <div class="saved-queries-actions">
                        <button id="savedQuerySave" type="button">Save</button>
                        <button id="savedQueryCancel" type="button" class="secondary">Cancel</button>
                    </div>
                </div>
                <div id="savedQueriesList"></div>
            </div>

            <!-- Backup & Restore Section -->
            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-muted);">
                <h3 style="color: var(--warning); margin-bottom: 16px;">üîí Backup & Restore</h3>

                <button id="createBackupButton" onclick="createBackup()" style="width: 100%; background: var(--success); color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; margin-bottom: 10px; font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 500;">
                    Create Backup
                </button>

                <button id="manageBackupsButton" onclick="showBackups()" style="width: 100%; background: var(--accent-primary); color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 500;">
                    Manage Backups
                </button>

                <div class="tip" style="margin-top: 16px;">
                    <div class="tip-content" style="font-size: 12px;">
                        Backups protect your search index. Always create a backup before major changes.
                    </div>
                </div>
            </div>

            <!-- Dataset (Active vs Snapshot) -->
            <div id="datasetPanel" style="margin-top: 18px; padding-top: 18px; border-top: 1px solid var(--border-muted);">
                <h3 style="margin-bottom: 10px;">Dataset</h3>
                <label style="display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 6px;">Active vs snapshot (read-only)</label>
                <select id="datasetSelect" style="width: 100%; background: var(--bg-surface); color: var(--text-primary); border: 1px solid var(--border-default); border-radius: 8px; padding: 8px 10px; font-family: 'Space Grotesk', sans-serif; font-size: 13px;">
                    <option value="">Active index</option>
                </select>
                <div class="tip" style="margin-top: 12px;">
                    <div class="tip-content" style="font-size: 12px;">
                        Snapshot mode is read-only. Indexing, backups, resume, chat, analytics, and dashboards are disabled.
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Theme Toggle -->
            <div class="theme-toggle">
                <button onclick="setTheme('light')" data-theme="light">Light</button>
                <button onclick="setTheme('system')" data-theme="system" class="active">System</button>
                <button onclick="setTheme('dark')" data-theme="dark">Dark</button>
            </div>

            <div id="datasetBanner" class="dataset-banner" style="display: none;"></div>

            <div id="conversationHeader" style="display: none; margin-bottom: 16px;">
                <a href="/" class="back-button">‚Üê Back to Search</a>
            </div>
            <h1 id="heroTitle" style="margin-bottom: 4px;"><span style="color: #4a9eff">sear</span><span style="background: linear-gradient(to right, #4a9eff, #ff9500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">ch</span><span style="color: #ff9500">at</span></h1>
            <p id="heroSubtitle" style="margin: 0 0 20px 0; font-size: 13px; color: #888;">Local search for your AI coding conversations</p>
            <input type="text" id="search" class="search-box" placeholder="Search conversations..." />
            <div id="projectSuggestion" class="project-suggestion" style="display: none;"></div>

            <div class="filters" id="filters">
        <label>Mode: 
            <select id="mode">
                <option value="hybrid">Hybrid</option>
                <option value="semantic">Semantic</option>
                <option value="keyword">Keyword</option>
            </select>
        </label>
        
        <label>Project: 
            <select id="project">
                <option value="">All Projects</option>
            </select>
        </label>

        <label>Tool:
            <select id="tool">
                <option value="">All Tools</option>
                <option value="claude">Claude Code</option>
                <option value="vibe">Vibe</option>
                <option value="opencode">OpenCode</option>
                <option value="codex">Codex</option>
                <option value="gemini">Gemini CLI</option>
                <option value="continue">Continue</option>
                <option value="cursor">Cursor</option>
                <option value="aider">Aider</option>
            </select>
        </label>
        
        <label>Date: 
            <select id="date" onchange="toggleCustomDate()">
                <option value="">Any time</option>
                <option value="today">Today</option>
                <option value="week">Last 7 days</option>
                <option value="month">Last 30 days</option>
                <option value="custom">Custom range</option>
            </select>
        </label>
        
        <span id="customDateRange" style="display:none;">
            <label>From: <input type="date" id="dateFrom" /></label>
            <label>To: <input type="date" id="dateTo" /></label>
        </span>
        
        <label>Sort by: 
            <select id="sortBy">
                <option value="relevance">Relevance</option>
                <option value="date_newest">Date (newest)</option>
                <option value="date_oldest">Date (oldest)</option>
                <option value="messages">Message count</option>
            </select>
        </label>

        <label style="display: inline-flex; align-items: center; gap: 6px;">
            <input type="checkbox" id="semanticHighlights" />
            Semantic highlights (LLM)
        </label>
        
        <button onclick="search()">Search</button>
        <button id="saveQueryButtonInline" type="button" style="background: #7c3aed; margin-left: 10px;">Save Query</button>
        <button onclick="showAllConversations()" style="background: #2196F3; margin-left: 10px;">Show All</button>
        <button onclick="showBookmarks()" style="background: #FFA500; margin-left: 10px;" title="View your bookmarked conversations">‚≠ê Bookmarks</button>
        <button id="analyticsButton" onclick="showAnalytics()" style="background: #00BCD4; margin-left: 10px;" title="View search analytics and patterns">üìä Analytics</button>
        <button id="dashboardsButton" onclick="showDashboards()" style="background: #546E7A; margin-left: 10px;" title="View saved dashboards">üß© Dashboards</button>
        <button id="bulkModeToggle" onclick="toggleBulkMode()" style="background: #9C27B0; margin-left: 10px;" title="Select multiple conversations for bulk export">‚òë Bulk Export</button>
        <button id="indexMissingButton" onclick="indexMissing()" style="background: #4CAF50; margin-left: 10px;" title="Safely add conversations that aren't in the index yet">Add Missing Conversations</button>
        <button onclick="shutdownServer()" style="background: #f44336; margin-left: 10px;" title="Stop the search server">Stop Server</button>
    </div>

    <div id="projectSummary" class="project-summary" style="display: none;"></div>

    <div class="chat-panel" id="chatPanel">
        <div class="chat-header">
            <div>
                <h2>Chat with History</h2>
                <p>Ask a question and get grounded answers with citations.</p>
            </div>
            <div class="chat-controls">
                <label>Provider:
                    <select id="chatProvider">
                        <option value="ollama">Ollama (Local)</option>
                        <option value="openai">OpenAI</option>
                    </select>
                </label>
                <label>Model:
                    <input type="text" id="chatModel" placeholder="optional" />
                </label>
                <details class="chat-advanced" id="chatAdvanced">
                    <summary>Options</summary>
                    <div class="chat-advanced-grid">
                        <label>Temperature:
                            <input type="number" id="chatTemperature" placeholder="default" min="0" max="2" step="0.1" />
                        </label>
                        <label>Max tokens:
                            <input type="number" id="chatMaxTokens" placeholder="default" min="1" max="32768" step="1" />
                        </label>
                        <label class="chat-advanced-wide">System prompt:
                            <textarea id="chatSystemPrompt" class="chat-system-prompt" placeholder="optional (context will be appended)"></textarea>
                        </label>
                    </div>
                </details>
            </div>
        </div>
        <div class="chat-body">
            <textarea id="chatQuery" class="chat-textarea" placeholder="Ask about your chat history..."></textarea>
            <div class="chat-actions">
                <button id="chatSend">Ask</button>
                <button id="chatStop" class="secondary">Stop</button>
                <button id="chatClear" class="secondary">Clear</button>
            </div>
            <div class="chat-status-row">
                <div id="chatSpinner" class="chat-spinner" aria-hidden="true"></div>
                <div id="chatStatus" class="chat-status"></div>
            </div>
            <div id="chatAnswer" class="chat-answer"></div>
            <div id="chatSources" class="chat-sources" style="display:none;"></div>
        </div>
    </div>

    <div id="results"></div>
        </div>

        <!-- Right Sidebar: Claude Self-Search Integration -->
        <div class="sidebar">
            <h3>ü§ñ Claude Self-Search</h3>

            <div class="tip">
                <div class="tip-title">Enable in Claude Code</div>
                <div class="tip-content">
                    Add this to <code>~/.claude/CLAUDE.md</code> so Claude can search its own conversation history:
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Search API</div>
                <div class="tip-content">
                    <code>curl "http://localhost:8000/api/search?q=YOUR_QUERY&limit=5"</code>
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Get Conversation</div>
                <div class="tip-content">
                    <code>curl "http://localhost:8000/api/conversation/CONV_ID"</code>
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Full Instructions</div>
                <div class="tip-content">
                    See <code>CLAUDE.example.md</code> in the searchat repo for the complete template to add to your global CLAUDE.md file.
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">Use Cases</div>
                <div class="tip-content">
                    ‚Ä¢ "Did we discuss X before?"<br>
                    ‚Ä¢ "Find past solutions for Y"<br>
                    ‚Ä¢ "How did we implement Z?"<br>
                    ‚Ä¢ Check previous debugging sessions
                </div>
            </div>

            <div class="tip">
                <div class="tip-title">API Parameters</div>
                <div class="tip-content">
                    <code>mode</code> - hybrid/semantic/keyword<br>
                    <code>limit</code> - max results (1-100)<br>
                    <code>project</code> - filter by project name
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript ES6 Module -->
    <script type="module" src="/static/js/main.js"></script>
</body>
</html>
